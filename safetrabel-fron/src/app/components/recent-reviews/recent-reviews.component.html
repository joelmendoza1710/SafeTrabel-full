<!-- Sección de título mejorada -->
<div class="relative mb-10">
  <div class="absolute inset-0 flex items-center" aria-hidden="true">
    <div class="w-full border-t border-gray-200"></div>
  </div>
  <div class="relative flex justify-center">
    <span class="bg-white px-6 py-2 text-center">
      <h2 class="text-3xl font-bold text-green-800 inline-flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-3 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
        </svg>
        Reseñas de Clientes
      </h2>
    </span>
  </div>
</div>

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
  <!-- Grid de reseñas -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    @for (review of paginatedReviews; track review.id) {
      <div class="bg-white rounded-xl shadow-lg overflow-hidden transition-all duration-300 hover:shadow-xl border border-gray-100 flex flex-col">
        <!-- Cabecera de la reseña -->
        <div class="bg-gradient-to-r from-green-50 to-white p-6 border-b border-gray-100">
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-green-700 rounded-full flex items-center justify-center text-white text-xl font-bold shadow-md">
              {{ review.user.name[0] }}
            </div>
            <div>
              <h3 class="font-bold text-xl text-gray-800">{{ review.user.name }}</h3>
              <div class="flex items-center mt-1">
                @for (star of [1, 2, 3, 4, 5]; track star) {
                  <svg
                    [class.text-yellow-400]="star <= review.rating"
                    [class.text-gray-300]="star > review.rating"
                    class="w-5 h-5"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                    aria-hidden="true"
                  >
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                }
                <span class="sr-only">Calificación: {{ review.rating }} de 5 estrellas</span>
                <span class="ml-2 text-sm font-medium text-gray-600">{{ review.rating }}.0</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Contenido de la reseña -->
        <div class="p-6 flex-grow">
          <!-- Ubicación -->
          <div class="flex items-center mb-4 bg-gray-50 rounded-lg p-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <div>
              <p class="font-medium text-gray-800">{{ review.location.name }}</p>
              <p class="text-sm text-gray-600">{{ review.location.city }}, {{ review.location.country }}</p>
            </div>
          </div>
          
          <!-- Comentario -->
          <div class="relative">
            <svg class="absolute top-0 left-0 transform -translate-x-6 -translate-y-2 h-8 w-8 text-gray-200" fill="currentColor" viewBox="0 0 32 32" aria-hidden="true">
              <path d="M9.352 4C4.456 7.456 1 13.12 1 19.36c0 5.088 3.072 8.064 6.624 8.064 3.36 0 5.856-2.688 5.856-5.856 0-3.168-2.208-5.472-5.088-5.472-.576 0-1.344.096-1.536.192.48-3.264 3.552-7.104 6.624-9.024L9.352 4zm16.512 0c-4.8 3.456-8.256 9.12-8.256 15.36 0 5.088 3.072 8.064 6.624 8.064 3.264 0 5.856-2.688 5.856-5.856 0-3.168-2.304-5.472-5.184-5.472-.576 0-1.248.096-1.44.192.48-3.264 3.456-7.104 6.528-9.024L25.864 4z" />
            </svg>
            <p class="relative text-gray-700 italic pl-6">{{ review.comment }}</p>
          </div>
          
          <!-- Fecha -->
          <div class="mt-6 flex justify-end">
            <div class="text-sm text-gray-500 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              {{ review.createdAt | date:'medium' }}
            </div>
          </div>

          <!-- Galería de imágenes (descomentada y mejorada) -->
          @if (review.images && review.images.length > 0) {
            <div class="mt-4">
              <p class="text-sm font-medium text-gray-500 mb-2">Fotos compartidas:</p>
              <div class="grid grid-cols-3 gap-2">
                @for (image of review.images.slice(0, 3); track image) {
                  <div class="relative group overflow-hidden rounded-lg">
                    <img
                      [src]="image"
                      alt="Imagen de la reseña"
                      class="w-full h-24 object-cover transition duration-300 group-hover:scale-110"
                      (click)="openFullSizeImage(image)"
                      (keydown.enter)="openFullSizeImage(image)"
                      tabindex="0"
                      role="button"
                      aria-label="Ver imagen en tamaño completo"
                    />
                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 flex items-center justify-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7" />
                      </svg>
                    </div>
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </div>
    }
  </div>

  <!-- Paginación mejorada -->
  <nav aria-label="Paginación de la lista de reseñas" class="mt-12 mb-8">
    <div class="flex items-center justify-center">
      <div class="inline-flex items-center rounded-md shadow-sm bg-white border border-gray-200 divide-x divide-gray-200">
        <button
          (click)="setCurrentPage(currentPage > 1 ? currentPage - 1 : 1)"
          [disabled]="currentPage === 1"
          class="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:z-10 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed rounded-l-md"
          aria-label="Página anterior"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
        
        @for (page of totalPages; track page) {
          <button
            (click)="setCurrentPage(page)"
            [class.bg-green-50]="currentPage === page"
            [class.text-green-700]="currentPage === page"
            [class.font-bold]="currentPage === page"
            [class.border-green-500]="currentPage === page"
            class="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:z-10 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"
            [attr.aria-current]="currentPage === page ? 'page' : null"
          >
            {{ page }}
          </button>
        }
        
        <button
          (click)="setCurrentPage(currentPage < totalPages.length ? currentPage + 1 : totalPages.length)"
          [disabled]="currentPage === totalPages.length"
          class="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:z-10 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed rounded-r-md"
          aria-label="Página siguiente"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
      </div>
    </div>
  </nav>
</div>

<!-- Modal de imagen a tamaño completo mejorado -->
@if (fullSizeImage) {
  <div
    class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4 backdrop-blur-sm"
    (click)="closeFullSizeImage()"
    (keydown.escape)="closeFullSizeImage()"
    tabindex="0"
  >
    <div class="relative max-w-5xl w-full">
      <img
        [src]="fullSizeImage"
        alt="Imagen en tamaño completo"
        class="max-w-full max-h-[85vh] object-contain mx-auto rounded-lg shadow-2xl"
        (click)="$event.stopPropagation()"
      />
      
      <button
        (click)="closeFullSizeImage()"
        class="absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full p-3 hover:bg-opacity-75 transition-colors duration-200 transform hover:scale-110"
        aria-label="Cerrar imagen"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <div class="absolute bottom-8 left-0 right-0 text-center text-white text-sm opacity-75">
      Haz clic en cualquier lugar o presiona ESC para cerrar
    </div>
  </div>
}